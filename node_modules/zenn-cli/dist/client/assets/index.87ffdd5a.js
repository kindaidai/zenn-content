var e=Object.defineProperty,t=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(t,n,r)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[n]=r;const s=document.getElementsByTagName("head")[0];let o=null;function a(){o&&clearTimeout(o)}const c=(e,t)=>{try{delete window[e]}catch(r){window[e]=void 0}const n=document.getElementById(t);n&&s.removeChild(n)};const d={};class l extends HTMLElement{constructor(){super();const e=this.attachShadow({mode:"open"}),t=d[this.getCacheKey()];t&&(e.innerHTML=t)}render(e){if(!(this.shadowRoot&&e.stylesheet&&e.div))return void this.renderError();const t=`<link rel="stylesheet" href="${e.stylesheet}"><div>${e.div}</div>`;d[this.getCacheKey()]=t,this.shadowRoot.innerHTML=t}renderError(){this.innerHTML=`<div style="text-align: center; margin: 1.5rem 0; color: gray; font-size: 0.9rem;">\n    Gistの読み込みに失敗しました<br>  \n    ${this.getAttribute("page-url")}\n    </div>`}getCacheKey(){return encodeURIComponent(`${this.getAttribute("page-url")}-${this.getAttribute("encoded-filename")}`)}async connectedCallback(){if(d[this.getCacheKey()])return;const e=this.getAttribute("page-url"),t=this.getAttribute("encoded-filename");if(!e)return;const n=((r=e).endsWith(".json")?r:r.endsWith(".js")?r.replace(".js",".json"):`${r}.json`)+((null==t?void 0:t.length)?`?file=${t}`:"");var r;try{const e=await function(e){const t=`jsonp_${Date.now()}_${Math.ceil(1e4*Math.random())}`,n=`id_${t}`;return new Promise(((r,i)=>{window[t]=e=>{r(e),a(),c(t,n)};const d=e+(e.includes("?")?"&":"?")+`callback=${t}`,l=document.createElement("script");l.setAttribute("src",d),l.setAttribute("charset","UTF-8"),l.id=n,s.appendChild(l),o=setTimeout((()=>{i(new Error(`Request to ${e} timed out.`)),c(t,n),window[t]=()=>c(t,n)}),6e3),l.addEventListener("error",(()=>{i(new Error(`JSONP request to ${e} failed`)),c(t,n),a()}))}))}(n);this.render(e)}catch(i){console.log(i),this.renderError()}}}const m={};class h extends HTMLElement{constructor(){super();const e=this.getAttribute("src");if(!e)return;this.url=e;const t=e.match(/https?:\/\/twitter.com\/(.*?)\/status\/(\d+)[/?]?/);t&&t[2]&&(this.tweetId=t[2])}async connectedCallback(){this.render(),this.embedTweet()}render(){const e=this.tweetId&&m[this.tweetId]?`style="min-height: ${encodeURIComponent(m[this.tweetId])};"`:"";this.innerHTML=`<div class="embed-tweet-container" ${e}>\n      <a href="${this.url}" class="embed-tweet-link" rel="nofollow">${this.url}</a>\n    </div>`}async embedTweet(){const e=this.tweetId;if(!this.url||!e)return void console.log(`Invalid tweet URL:${this.url}`);const s=this.querySelector(".embed-tweet-container"),o=this.url.includes("?conversation=none");window.twttr.widgets.createTweet(this.tweetId,s,((e,s)=>{for(var o in s||(s={}))n.call(s,o)&&i(e,o,s[o]);if(t)for(var o of t(s))r.call(s,o)&&i(e,o,s[o]);return e})({align:"center"},o?{conversation:"none"}:{})).then((()=>{var t;null==(t=this.querySelector(".embed-tweet-link"))||t.remove();const n=this.querySelector("iframe");n&&setTimeout((()=>{m[e]=n.style.height}),1e3)}))}}const u={};function y({src:e,id:t}){return new Promise(((n,r)=>{if(document.getElementById(t)){const e=setInterval((()=>{u[t]&&(clearInterval(e),n())}),100)}else{const i=document.createElement("script");i.setAttribute("src",e),i.setAttribute("id",t),document.head.appendChild(i),i.onload=()=>{u[t]=!0,n()},i.onerror=e=>r(e)}}))}class f extends HTMLElement{constructor(){super();const e=document.createElement("div");e.setAttribute("id","katex-container"),this._container=e}async connectedCallback(){this.render()}async render(){var e;"undefined"==typeof katex&&await y({src:"https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js",id:"katex-js"}),function({href:e,id:t}){new Promise(((n,r)=>{if(document.getElementById(t))return n();const i=document.createElement("link");i.setAttribute("href",e),i.setAttribute("rel","stylesheet"),i.setAttribute("id",t),document.head.appendChild(i),i.onload=()=>{n()},i.onerror=e=>r(e)}))}({href:"https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css",id:"katex-css"});const t=!!this.getAttribute("display-mode");null==katex||katex.render(null!=(e=this.innerText)?e:"",this._container,{macros:{"\\RR":"\\mathbb{R}"},throwOnError:!1,displayMode:t}),this.innerHTML=this._container.innerHTML}}class p extends HTMLElement{constructor(){super(),this._sourceContainer=this.childNodes[0];const e=document.createElement("div");this.appendChild(e),this._svgContainer=e}async connectedCallback(){this.render()}async render(){await async function(){if("undefined"==typeof mermaid){await y({src:"https://cdn.jsdelivr.net/npm/mermaid@8.10/dist/mermaid.min.js",id:"mermaid-js"});const e="default";mermaid.initialize({mermaid:{startOnLoad:!1}}),mermaid.mermaidAPI.initialize({startOnLoad:!1,securityLevel:"strict",theme:e,er:{useMaxWidth:!0},flowchart:{useMaxWidth:!0,htmlLabels:!1},sequence:{useMaxWidth:!0}})}}();const e=this._sourceContainer.innerText||"";if(!e)return;const t=function(e){return{syntaxError:{yes:!(()=>{try{return mermaid.mermaidAPI.parse(e),!0}catch(t){return console.log("mermaid.js のレンダリングでシンタックスエラーが発生しました",t),!1}})(),message:"<li>シンタックスエラーです</li>"},charLimitOver:{yes:e.length>2e3,message:"<li>ブロックあたりの文字数上限は2000です</li>"},chainingOfLinksOver:{yes:(e.match(/&/g)||[]).length>10,message:"<li>ブロックあたりの<code>&</code>によるチェイン上限は10です</li>"}}}(e);if(Object.values(t).map((e=>e.yes)).includes(!0))return void(this.innerHTML=`\n       <p>\n        <span>mermaidをレンダリングできません。</span>\n        <ul>\n        ${t.syntaxError.yes?t.syntaxError.message:""}\n        ${t.charLimitOver.yes?t.charLimitOver.message:""}\n        ${t.chainingOfLinksOver.yes?t.chainingOfLinksOver.message:""}\n        </ul>\n       </p>\n      `);null==mermaid||mermaid.mermaidAPI.render(`mermaid-container-${Date.now().valueOf()}-render`,e,(e=>{this._svgContainer.innerHTML=e}),this._sourceContainer)}}customElements.define("embed-gist",l),customElements.define("embed-tweet",h),customElements.define("embed-katex",f),customElements.define("embed-mermaid",p);
