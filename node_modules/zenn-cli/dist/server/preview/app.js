"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createApp = void 0;
var express_1 = __importDefault(require("express"));
var path_1 = __importDefault(require("path"));
var connect_history_api_fallback_1 = __importDefault(require("connect-history-api-fallback"));
var articles_1 = require("./api/articles");
var books_1 = require("./api/books");
var cli_guide_1 = require("./api/cli-guide");
var local_info_1 = require("./api/local-info");
var cli_version_1 = require("./api/cli-version");
var helper_1 = require("../lib/helper");
function createApp() {
    var app = express_1.default();
    app.get("/api/articles", articles_1.getArticles);
    app.get("/api/articles/:slug", articles_1.getArticle);
    app.get("/api/books", books_1.getBooks);
    app.get("/api/books/:slug", books_1.getBook);
    app.get("/api/books/:book_slug/chapters", books_1.getChapters);
    app.get("/api/books/:book_slug/chapters/:chapter_filename", books_1.getChapter);
    app.get("/api/cli-guide/:slug", cli_guide_1.getCliGuide);
    app.get("/api/cli-version", cli_version_1.getCliVersion);
    app.get("/api/local-info", local_info_1.getLocalInfo);
    app.get('/images/*', function (req, res) {
        // `zenn preview`を起動したディレクトリ直下にあるimagesディレクトリを参照する
        res.sendFile(helper_1.getWorkingPath(req.path));
    });
    // serve static files built by vite
    app.use(connect_history_api_fallback_1.default()); // required to directly access non-root pages such as /guide, /articles/foo
    app.use(express_1.default.static(path_1.default.join(__dirname, '../../client'), {
        setHeaders: function (res) {
            res.setHeader('Cache-Control', 'no-store, no-cache, must-revalidate');
        },
    }));
    return app;
}
exports.createApp = createApp;
